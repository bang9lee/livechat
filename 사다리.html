<!DOCTYPE html>
<html>
<head>
<title>사다리 게임</title>
<style>
body {
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background-color: #1e1e1e;
    margin: 0;
    color: #fff;
}
.game-container {
    display: flex;
    gap: 30px;
    background-color: #2f2f2f;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}
.ladder-container {
    position: relative;
    width: 200px;
    height: 400px;
    border: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    padding: 20px 0;
    overflow: hidden;
    background-color: #2f2f2f;
}
.ladder-line {
    position: absolute;
    width: 8px;
    height: 100%;
    background-color: #555;
    top: 0;
    border-radius: 4px;
}
.ladder-line.left {
    left: 20px;
}
.ladder-line.right {
    right: 20px;
}
.horizontal-line {
    position: absolute;
    left: 20px;
    width: calc(100% - 40px);
    height: 8px;
    background-color: #555;
    border-radius: 4px;
}
.icon-container {
    display: flex;
    justify-content: space-between;
    width: 100%;
    padding: 0 20px;
    z-index: 1;
}
.icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #fff;
    font-weight: bold;
    z-index: 1;
    border: 4px solid;
    font-size: 1.2em;
}
.blue {
    background-color: #4285f4;
    border-color: #6699cc;
    color: #e0e7ef;
}
.red {
    background-color: #ff5722;
    border-color: #e67351;
    color: #ffe0d2;
}
.label {
    text-align: center;
    margin-top: 10px;
    z-index: 1;
}
#countdown {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 24px;
    font-weight: bold;
    z-index: 1;
    color: #eee;
}
.result-container {
    width: 200px;
    padding: 20px;
    border: 1px solid #555;
    border-radius: 10px;
    text-align: center;
    max-height: 300px;
    overflow-y: scroll;
    background-color: #3d3d3d;
}
.result-box {
    margin-bottom: 10px;
    padding: 10px;
    border: 1px solid #777;
    border-radius: 5px;
    background-color: #4a4a4a;
}
#path {
    position: absolute;
    top: 35px;
    left: 50px;
    width: 0;
    height: 0;
    border-top: 10px solid transparent;
    border-left: 10px solid #ffc107;
    border-bottom: 10px solid transparent;
    z-index: 0;
    transition: all 1s linear;
    border-radius: 5px;
}
.pathing #path {
    width: 0;
    height: 0;
}
#round-number {
    font-size: 1.2em;
    font-weight: bold;
    margin-bottom: 10px;
    color: #eee;
}
</style>
</head>
<body>

<div class="game-container">
    <div class="ladder-container">
        <div class="ladder-line left"></div>
        <div class="ladder-line right"></div>
        <div class="icon-container" style="top: 0;">
            <div class="icon blue start-icon left-icon">좌</div>
            <div class="icon red start-icon right-icon">우</div>
        </div>
        <div id="horizontal-lines">
            </div>
        <div id="countdown">게임 대기중</div>
        <div class="icon-container" style="bottom: 0;">
            <div class="icon blue end-icon odd-icon">홀</div>
            <div class="icon red end-icon even-icon">짝</div>
        </div>

        <div id="path"></div>
    </div>

    <div class="result-container">
        <h2>결과 창</h2>
        <div id="round-number">회차: <span id="current-round">1</span></div>
        <div id="game-results">
            </div>
    </div>
</div>

<script>
const horizontalLinesDiv = document.getElementById('horizontal-lines');
const countdownDisplay = document.getElementById('countdown');
const gameResultsDiv = document.getElementById('game-results');
const pathElement = document.getElementById('path');
const ladderContainer = document.querySelector('.ladder-container');
const roundNumberDisplay = document.getElementById('current-round');

let gameTimer;
let timeLeft = 2;
let gameHistory = [];
let currentPath = [];
let roundNumber = 1;

function updateCountdown() {
    const minutes = Math.floor(timeLeft / 60);
    let seconds = timeLeft % 60;
    seconds = seconds < 10 ? '0' + seconds : seconds;
    countdownDisplay.textContent = `${minutes}:${seconds}`;
    if (timeLeft <= 0) {
        clearInterval(gameTimer);
        countdownDisplay.textContent = '게임 시작!';
        startGame();
        timeLeft = 5 * 60;
        if (roundNumber < 288) {
            roundNumber++;
        } else {
            roundNumber = 1;
        }
        roundNumberDisplay.textContent = roundNumber;
        gameTimer = setInterval(updateCountdown, 1000);
    }
    timeLeft--;
}

function createHorizontalLines() {
    horizontalLinesDiv.innerHTML = '';
    const numberOfLines = Math.random() < 0.5 ? 3 : 4;
    const linePositions = [];
    for (let i = 0; i < numberOfLines; i++) {
        let position;
        do {
            position = Math.random() * 0.8 + 0.1;
        } while (linePositions.some(pos => Math.abs(pos - position) < 0.15));
        linePositions.push(position);
    }
    linePositions.sort((a, b) => a - b);

    linePositions.forEach(position => {
        const line = document.createElement('div');
        line.classList.add('horizontal-line');
        line.style.top = `${position * 100}%`;
        horizontalLinesDiv.appendChild(line);
    });
    return linePositions;
}

function getGameResult(startPoint, linePositions) {
    let currentPosition = startPoint;
    let lineCount = 0;
    let pathCoords = [];
    const lines = document.querySelectorAll('#horizontal-lines .horizontal-line');
    const startIcons = document.querySelectorAll('.start-icon');
    const endIcons = document.querySelectorAll('.end-icon');
    const ladderLines = document.querySelectorAll('.ladder-line');

    let currentX = startPoint === 0 ? startIcons[0].offsetLeft + startIcons[0].offsetWidth / 2 : startIcons[1].offsetLeft + startIcons[1].offsetWidth / 2;
    let currentY = startIcons[0].offsetTop + startIcons[0].offsetHeight;
    pathCoords.push({x: currentX, y: currentY});

    linePositions.forEach(lineTop => {
        const lineElement = lines[lineCount];
        const lineY = lineElement.offsetTop + lineElement.offsetHeight / 2;
        const nextX = currentPosition === 0 ? ladderLines[1].offsetLeft : ladderLines[0].offsetLeft + ladderLines[0].offsetWidth;


        pathCoords.push({x: currentX, y: lineY});
        currentX = nextX;
        pathCoords.push({x: currentX, y: lineY});

        lineCount++;
        currentPosition = 1 - currentPosition;
    });

    // 최종 결과 아이콘의 *하단* Y 좌표를 사용하도록 수정 (기존: 중앙 Y 좌표)
    currentY = endIcons[0].offsetTop + endIcons[0].offsetHeight;
    pathCoords.push({x: currentX, y: currentY});

    const startLabel = startPoint === 0 ? '좌' : '우';
    const endLabel = currentPosition === 0 ? '홀' : '짝';
    return {
        resultText: `${startLabel} ${lineCount} ${endLabel}`,
        pathCoords: pathCoords
    };
}


function displayGameResult(result, round) {
    const resultElement = document.createElement('div');
    resultElement.classList.add('result-box');
    resultElement.textContent = `[${round}회차] ${result}`;
    gameResultsDiv.prepend(resultElement);
    if (gameHistory.length > 5) {
        gameResultsDiv.removeChild(gameResultsDiv.lastElementChild);
    }
}

function animatePath(pathCoords, gameResultText, currentRound) {
    pathElement.style.transition = 'none';
    pathElement.style.width = '0';
    pathElement.style.height = '0';
    pathElement.style.top = `${pathCoords[0].y - 5}px`;
    pathElement.style.left = `${pathCoords[0].x - 10}px`;
    pathElement.style.borderLeftWidth = '10px';


    ladderContainer.classList.add('pathing');

    setTimeout(() => {
        pathElement.style.transition = 'all 1s linear';
        let delay = 0.1;
        let animationSteps = [];

        for (let i = 1; i < pathCoords.length; i++) {
            const prevCoord = pathCoords[i - 1];
            const currentCoord = pathCoords[i];
            const diffX = currentCoord.x - prevCoord.x;
            const diffY = currentCoord.y - prevCoord.y;

            if (diffY !== 0) {
                animationSteps.push({
                    property: 'height',
                    value: `${Math.abs(diffY)}px`,
                    translateX: '0px',
                    translateY: diffY > 0 ? '0px' : `-${Math.abs(diffY)}px`,
                    duration: Math.abs(diffY) / 100
                });
            } else if (diffX !== 0) {
                 animationSteps.push({
                    property: 'width',
                    value: `${Math.abs(diffX)}px`,
                    translateX: diffX > 0 ? '0px' : `-${Math.abs(diffX)}px`,
                    translateY: '0px',
                    duration: Math.abs(diffX) / 100
                });
            }
        }


        function animateStep(stepIndex) {
            if (stepIndex < animationSteps.length) {
                const step = animationSteps[stepIndex];
                pathElement.style.transitionDuration = `${step.duration}s`;


                if (step.property === 'height') {
                    pathElement.style.height = step.value;
                     pathElement.style.width = '0px';
                } else if (step.property === 'width') {
                    pathElement.style.width = step.value;
                    pathElement.style.height = '0px';
                }


                pathElement.style.transform = `translateX(${step.translateX}) translateY(${step.translateY})`;


                setTimeout(() => animateStep(stepIndex + 1), step.duration * 1000);
            } else {
                ladderContainer.classList.remove('pathing');
                displayGameResult(gameResultText, currentRound);
                horizontalLinesDiv.innerHTML = '';
            }
        }

        animateStep(0);
    }, 100);
}


function startGame() {
    const linePositions = createHorizontalLines();
    const startPoints = [0, 1];
    const randomStartPoint = startPoints[Math.floor(Math.random() * startPoints.length)];
    const gameResult = getGameResult(randomStartPoint, linePositions);
    animatePath(gameResult.pathCoords, gameResult.resultText, roundNumber);
    gameResultsDiv.innerHTML = '';
}


// Start countdown timer
updateCountdown();
gameTimer = setInterval(updateCountdown, 1000);
</script>